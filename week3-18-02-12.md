# Week 3

## News
This week, Vapor passed Perfect and has earned the title of the most stars of any server-side Swift framework on Github! ðŸŽ‰ðŸŽ‰ðŸŽ‰ðŸŽ‰Congrats to the team!

## New Features

### Helper Methods to Decode Content From Request Bodies
It's very common to need to take the body of a request and decode it to an object, so to cut down on boilerplate, new methods were introduced to do that automatically on any HTTP method that accepts a body.

```swift
router.post(LoginRequest.self, at: "login") { req, loginRequest -> Response in
    print(loginRequest.email) // user@vapor.codes
    print(loginRequest.password) // don't look!
    return req.makeResponse()
}
```

[vapor/vapor#1448](https://github.com/vapor/vapor/pull/1448)

### Case Insensitive Routing

Routing is still case-sensitive by default, but it can now be adjusted.

```swift
router.get("hello") { req -> HTTPStatus in
    return .ok
}
```


#### Case-sensitive
`GET /hello -> 200 OK`  
`GET /Hello -> 404 Not Found`

#### Case-insensitive
`GET /hello -> 200 OK`  
`GET /Hello -> 200 OK`

[vapor/engine#209](https://github.com/vapor/engine/pull/209)

### Value Models

Allows structs to be used as Fluent Models

[vapor/fluent#372](https://github.com/vapor/fluent/pull/372)

## Community Contributions

### Session Redirects
[@0xTim](https://github.com/0xTim) introduced middleware to the Auth package that makes it easy to redirect users to another page in case they aren't authenticated. For example, if a user attempted to visit a private page while they're logged out, you may want to redirect them to `/login` instead.

[vapor/auth#19](https://github.com/vapor/auth/pull/19)

### Dependency Updates
With the start of tagging, keeping `Package.swift` files up-to-date is an easy and tedious, but important task. If you're looking to pitch in, but don't know where to start, plenty of help is needed in this area. There are going to be a lot of these, so we're going to group them all together:

[vapor/fluent-postgresql#13](https://github.com/vapor/fluent-postgresql/pull/13)  
[vapor/leaf#90](https://github.com/vapor/leaf/pull/90)  
[vapor/mysql#123](https://github.com/vapor/mysql/pull/123)  
[vapor/postgresql#16](https://github.com/vapor/postgresql/pull/16)  
[vapor/fluent-postgresql#14](https://github.com/vapor/fluent-postgresql/pull/14)
[vapor/vapor#1498](https://github.com/vapor/vapor/pull/1498)  
[vapor/mysql#124](https://github.com/vapor/mysql/pull/124)

### Fixed DatabaseConnection Bug
[@bensyverson](https://github.com/bensyverson) caught that `database-kit` was making a bad assert (`==` vs `!=`)

[vapor/database-kit#6](https://github.com/vapor/database-kit/pull/6)

### Add Providers to OpenSSL
Adding providers to the `ctls` package means that SPM will let users know when they're missing a dependency - [@Yasumoto](https://github.com/Yasumoto)

[vapor/ctls#7](https://github.com/vapor/ctls/pull/7)

### Fix Issue Where Large Responses Hang
With larger HTTP bodies, the `continueBuffer` state was not being handled correctly, causing the last chunk to not be sent, and responses to hang. This bug existed in both Vapor 2 and 3. Thanks! [@kevinup7](https://github.com/kevinup7)

[vapor/engine#222](https://github.com/vapor/engine/pull/222)

### Redundancy Ceanup
[@Cellane](https://github.com/Cellane) was able to cut out a couple lines of redundant code. Any cleanup is always appreciated :)

[vapor/engine#224](https://github.com/vapor/engine/pull/224)

### Allow Users of MultipartForm To Set Max Request Size 
The maximum request size used to be locked at 1,000,000 bytes, but [@bensyverson](https://github.com/bensyverson)'s PR frees users to set their own max request size in case they need something larger

[vapor/vapor#1494](https://github.com/vapor/vapor/pull/1494)

### Fixes Packet Length and SequenceID
This fix by [@SandorDobi](https://github.com/SandorDobi) should resolve a couple MySQL bugs.

[vapor/mysql#122](https://github.com/vapor/mysql/pull/122)

### Add `delete(on:)` and `save(on:)` to `Future`
[@twof](https://github.com/twof) merged in a couple of convenience extesions on `Future` that make saving and or deleting a model much cleaner. From

```swift
return Reservation
    .query(on: databaseConnectable)
    .filter(\Reservation.user == userName)
    .first()
    .unwrap(or: Abort(.notFound, reason: "No reservations have been made"))
    .map(to: Reservation.self) { reservation in
        return reservation.delete(on: databaseConnectable).transform(to: reservation)
    }.map(to: HTTPStatus.self) { _ in
        return .ok
    }
```
to
```swift
return Reservation
    .query(on: databaseConnectable)
    .filter(\Reservation.user == userName)
    .first()
    .unwrap(or: Abort(.notFound, reason: "No reservations have been made"))
    .delete(on: databaseConnectable)
    .map(to: HTTPStatus.self) { _ in
        return .ok
    }
```

[vapor/fluent#371](https://github.com/vapor/fluent/pull/371)

### Fatal Error Cleanup
As Vapor gets closer to stability, fatal errors need to be removed so that servers aren't crashing in production. [@labradon](https://github.com/labradon) got the project well on its way by eliminating 29 fatal errors and replacing them with their proper thrown errors. (33 LoC)

[vapor/postgresql#15](https://github.com/vapor/postgresql/pull/15)

### Update Vapor Toolbox For Most Recent Version of SPM
There were a few deprecated options that made the toolbox unusable for a bit, but all is good again!

[vapor/toolbox#210](https://github.com/vapor/toolbox/pull/210)

### Improved Error Message
[@gwynne](https://github.com/gwynne) updated error messages when hostname and port are misconfigured, which ought to make debugging a bit easier.

[vapor/sockets#161](https://github.com/vapor/sockets/pull/161)

## Benchmarks
### 17k Queries Per Second Per Core Achieved With Fluent/MySQL
That should scale infinitely with the number of cores too. Awesome!

[https://twitter.com/JoannisOrlandos/status/964792631875244034](https://twitter.com/JoannisOrlandos/status/964792631875244034)

## Talks

### Joannis @ Swift Amsterdam
#### HELP NEEDED: Description

[https://swift.amsterdam/talks/serverside-joannis-orlandos.html](https://swift.amsterdam/talks/serverside-joannis-orlandos.html)

## Tutorials

### Ray Wenderlich Video Course and Upcoming Book by [@0xtim](https://github.com/0xtim)
In this 30-video course, youâ€™ll use Vapor, a server-side Swift web framework, to create a complex application that you can talk to via an API and a website. The first 4 videos are available now!

[https://www.raywenderlich.com/186386/new-course-server-side-swift-with-vapor](https://www.raywenderlich.com/186386/new-course-server-side-swift-with-vapor)

Pre-orders also opened up for the Ray Wenderlich Vapor 3 book written by the core Vapor team themselves! This book starts with the basics of web development and introduces the basics of Vapor; it then walks you through creating APIs and web backends; creating and configuring databases; deploying to Heroku, AWS, or Docker; testing your creations and more!

[https://store.raywenderlich.com/products/server-side-swift-with-vapor](https://store.raywenderlich.com/products/server-side-swift-with-vapor)

### How To Set Up a Vapor 3 Project
In this tutorial [@martinlasek](https://github.com/martinlasek) is going to take you through all the steps needed to get you from installing Xcode to making requests to your Vapor server.

[https://medium.com/@martinlasek/tutorial-how-to-set-up-a-vapor-3-project-75466394cf2e](https://medium.com/@martinlasek/tutorial-how-to-set-up-a-vapor-3-project-75466394cf2e)

## Microtutorial
This week we're going to take a look at how to wrap up our `.map()`s to make promise chains a little more readable.

***

## Credits
[@twof](https://github.com/twof)  
[@calebkleveter](https://github.com/calebkleveter)  
[@Cellane](https://github.com/Cellane)  
[@tanner0101](https://github.com/tanner0101)
